 ## Cancellation
**êµ¬ì¡°í™”ëœ ë™ì‹œì„±ì—ì„œ ì‘ì—… ì·¨ì†Œë¥¼ ì „íŒŒí•˜ëŠ” ë°©ë²•**

---

###  ê°œìš”

ì‘ì—…ì˜ ì·¨ì†ŒëŠ” ë‹¨ìˆœíˆ ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì— ê·¸ì¹˜ì§€ ì•Šê³ , ëª…í™•í•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ íë¦„ì„ ìœ ì§€í•˜ë©°, ìš°ìˆ˜í•œ ì‚¬ìš©ì ê²½í—˜(UX)ì„ ì œê³µí•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ìš°ë¦¬ê°€ ì‚¬ì§„ì²© ì•±ì„ ìŠ¤í¬ë¡¤í•œë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ìŠ¤í¬ë¡¤ì„ í•˜ë©´ì„œ í™”ë©´ì— ë³´ì´ëŠ” ì…€ì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë¶ˆëŸ¬ì˜¤ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ°ë° ì‚¬ìš©ìê°€ ë¹ ë¥´ê²Œ ìŠ¤í¬ë¡¤í•˜ì—¬ í•´ë‹¹ ì…€ì´ í™”ë©´ì—ì„œ ì‚¬ë¼ì§€ë©´, ì•„ì§ ë¡œë”© ì¤‘ì¸ ì´ë¯¸ì§€ ì‘ì—…ì€ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šê²Œ ë˜ì£ . ì´ëŸ° ìƒí™©ì—ì„œ ì—¬ì „íˆ ë³´ì´ì§€ ì•ŠëŠ” ì…€ì„ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ê³„ì† ìœ ì§€í•˜ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì´ë©°, ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ ë‚­ë¹„í•˜ê²Œ ë©ë‹ˆë‹¤.

Swift Concurrencyê°€ ë„ì…ë˜ê¸° ì „ê¹Œì§€ëŠ” ì´ëŸ¬í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì•ˆì „í•˜ê³  êµ¬ì¡°ì ìœ¼ë¡œ ì·¨ì†Œí•˜ê¸°ê°€ ê¹Œë‹¤ë¡œì› ìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ `DispatchQueue`ë¥¼ ì‚¬ìš©í•  ê²½ìš°, `DispatchWorkItem`ì„ ìƒì„±í•´ `cancel()`ì„ í˜¸ì¶œí•¨ìœ¼ë¡œì¨ ì‘ì—…ì„ ì·¨ì†Œí•  ìˆ˜ëŠ” ìˆì—ˆì§€ë§Œ, 
* ì·¨ì†Œ ìƒíƒœì˜ ì „íŒŒê°€ ì–´ë µê³ ,
* ì¤‘ì²© ì‘ì—…ì´ë‚˜ ë¹„ë™ê¸° ì²´ì¸ì˜ ê´€ë¦¬ê°€ ê¹Œë‹¤ë¡œì› ìŠµë‹ˆë‹¤.

ì´ëŸ° í•œê³„ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ `OperationQueue`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆì—ˆì§€ë§Œ, êµ¬í˜„ì´ ë³µì¡í•˜ê³  ì½”ë“œ ì–‘ì´ ë§ì•„ì§€ëŠ” ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

```swift
let globalQueue = DispatchQueue.global()

var outerItem = DispatchWorkItem {
    for i in 0...10 {
        if outerItem.isCancelled { break }
        sleep(1)
        print("â¡ï¸ ì™¸ë¶€ ì‘ì—… ìˆ˜í–‰ ì™„ë£Œ: \(i)")
    }
    
    let innerItem = DispatchWorkItem { 
        for j in 0...10 {
            print("âœ¨ ë‚´ë¶€ ì‘ì—… ìˆ˜í–‰ ì™„ë£Œ: \(j)")
        }
    }
    globalQueue.async(execute: innerItem)
}
globalQueue.async(execute: outerItem)

globalQueue.asyncAfter(deadline: .now() + 3) {
    outerItem.cancel()
}
```

ìœ„ ì˜ˆì œëŠ” GCD ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œ ì·¨ì†Œê°€ êµ¬ì¡°ì ìœ¼ë¡œ ì „íŒŒë˜ì§€ ì•ŠëŠ” í•œê³„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì™¸ë¶€ ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆì§€ë§Œ, ê·¸ ë‚´ë¶€ì—ì„œ ë“±ë¡ëœ ì‘ì—…ì€ ì—¬ì „íˆ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ëŠ” Swift Concurrencyì˜ `Task`ì™€ëŠ” ë‹¬ë¦¬, **ì·¨ì†Œ ì „íŒŒ(cancellation propagation)** ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

Swift ConcurrencyëŠ” ë³´ë‹¤ êµ¬ì¡°í™”ë˜ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ ë°©ì‹ìœ¼ë¡œ ì‘ì—… ì·¨ì†Œë¥¼ ì§€ì›í•˜ë©°, ì´ì— ë”°ë¼ ì‘ì—…ì˜ ì·¨ì†Œ ì—¬ë¶€ë¥¼ ì‰½ê²Œ í™•ì¸í•˜ê³  í•„ìš”í•œ ê²½ìš° ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” APIë¥¼ ì œê³µí•©ë‹ˆë‹¤. êµ¬ì¡°í™”ëœ ë™ì‹œì„±(Structured Concurrency)ì—ì„œëŠ” ì‘ì—…ì´ ìƒìœ„-í•˜ìœ„ ê´€ê³„ì˜ íŠ¸ë¦¬(Task Tree) í˜•íƒœë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì´ êµ¬ì¡°ì—ì„œëŠ” ìƒìœ„ ì‘ì—…ì—ì„œ ì·¨ì†Œ ì‹ í˜¸ê°€ ë°œìƒí•˜ë©´, í•´ë‹¹ ì‹ í˜¸ê°€ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì—ê²Œ ì „íŒŒë©ë‹ˆë‹¤. í•˜ìœ„ ì‘ì—…ë“¤ì€ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ë¥¼ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬(clean up)í•œ í›„, ìƒìœ„ ì‘ì—…ì—ê²Œ ì¢…ë£Œë¥¼ ì•Œë¦¬ê³ , ëª¨ë“  í•˜ìœ„ ì‘ì—…ì´ ì •ë¦¬ë˜ë©´ ìƒìœ„ ì‘ì—…ë„ í•¨ê»˜ ì¢…ë£Œë©ë‹ˆë‹¤. êµ¬ì¡°í™”ë˜ì§€ ì•Šì€ ë™ì‹œì„±(Unstructured)ì€ ì‘ì—… íŠ¸ë¦¬ë¥¼ êµ¬ì„±í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì‘ì—… ì·¨ì†Œê°€ ì „íŒŒë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, ë°”ê¹¥ ì‘ì—…ì´ ì·¨ì†Œë˜ë”ë¼ë„, ë³„ë„ë¡œ ìƒì„±ëœ ì•ˆìª½ ì‘ì—…ì€ í•´ë‹¹ ì·¨ì†Œ ì „íŒŒë¥¼ ë°›ì§€ ëª»í•˜ë©°, ë…ë¦½ì ìœ¼ë¡œ ê³„ì† ì‹¤í–‰ë©ë‹ˆë‹¤.

 Swift Concurrency **í˜‘ë ¥ì  ì·¨ì†Œ(Cooperative Cancellation)** ëª¨ë¸ì„ ë”°ë¦…ë‹ˆë‹¤. ê° ì‘ì—…ì€ ì‹¤í–‰ ë„ì¤‘ì— ìŠ¤ìŠ¤ë¡œ ì·¨ì†Œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ê·¸ì— ë§ëŠ” ì²˜ë¦¬ë¥¼ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì¦‰, ìƒìœ„ ì‘ì—…ì´ í•˜ìœ„ ì‘ì—…ì—ê²Œ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•˜ë”ë¼ë„, í•˜ìœ„ ì‘ì—…ì´ ê³§ë°”ë¡œ ì¢…ë£Œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¨ìˆœíˆ `Task.isCancelled` í”„ë¡œí¼í‹°ë¥¼ `true`ë¡œ ë°”ê¿€ ë¿ì…ë‹ˆë‹¤. ì´ëŠ” ê° ì‘ì—…ë§ˆë‹¤ ì·¨ì†Œë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ ë‹¤ë¥¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì–´ë–¤ ì‘ì—…ì€ ì·¨ì†Œ ì‹œ ì¤‘ê°„ ë°ì´í„°ë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆê³ , ì–´ë–¤ ì‘ì—…ì€ ì•„ì˜ˆ ì˜ˆì™¸ë¥¼ ë˜ì ¸ë²„ë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì‘ì—…ì„ êµ¬ì„±í•  ë•ŒëŠ” ëŠ˜ ì‘ì—…ì˜ ì·¨ì†Œë¥¼ ê³ ë ¤í•˜ì—¬ ì„¤ê³„í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.

Swift Concurrencyì—ì„œëŠ” ì‘ì—… ë‚´ë¶€ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì·¨ì†Œ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* `Task.isCancelled`: ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸ (true / false)

* `Task.checkCancellation()`: ì·¨ì†Œë˜ì—ˆì„ ê²½ìš° `CancellationError`ë¥¼ ë˜ì§

ì¼ë°˜ì ìœ¼ë¡œ, ì‘ì—… ì·¨ì†Œ ì—¬ë¶€ë§Œ ê°ì§€í•˜ê³  ë”°ë¡œ ì²˜ë¦¬í•  ê²½ìš°ì—ëŠ” `Task.isCancelled`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë°˜ë³€ì— ì¦‰ì‹œ ì‘ì—…ì„ ì·¨ì†Œí•˜ê³  íë¦„ì„ ëŠì–´ì•¼ í•  ìƒí™©ì´ë¼ë©´ `Task.checkCancellation()`ì„ ì‚¬ìš©í•´ `CancellationError`ë¥¼ ë˜ì§€ëŠ” ë°©ì‹ì´ ì í•©í•©ë‹ˆë‹¤.



### êµ¬ì¡°í™”ëœ ë™ì‹œì„±(Structured Concurrency)

êµ¬ì¡°í™”ëœ ë™ì‹œì„±(Structured Concurrency)ì—ì„œëŠ” ì‘ì—…ì´ ìƒìœ„-í•˜ìœ„ ê´€ê³„ì˜ íŠ¸ë¦¬(Task Tree) í˜•íƒœë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì´ êµ¬ì¡°ì—ì„œëŠ” ìƒìœ„ ì‘ì—…ì—ì„œ ì·¨ì†Œ ì‹ í˜¸ê°€ ë°œìƒí•˜ë©´, í•´ë‹¹ ì‹ í˜¸ê°€ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì—ê²Œ ì „íŒŒë©ë‹ˆë‹¤. í•˜ìœ„ ì‘ì—…ë“¤ì€ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ë¥¼ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬(clean up)í•œ í›„, ìƒìœ„ ì‘ì—…ì—ê²Œ ì¢…ë£Œë¥¼ ì•Œë¦¬ê³ , ëª¨ë“  í•˜ìœ„ ì‘ì—…ì´ ì •ë¦¬ë˜ë©´ ìƒìœ„ ì‘ì—…ë„ í•¨ê»˜ ì¢…ë£Œë©ë‹ˆë‹¤.

êµ¬ì¡°í™”ëœ ë™ì‹œì„±(Structured Concurrency)ì—ì„œì˜ ì‘ì—… ì·¨ì†Œ ì „íŒŒëŠ” ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ **ì•”ì‹œì (implicit) ì·¨ì†Œ ì „íŒŒ** ì™€ **ëª…ì‹œì (explicit) ì·¨ì†Œ ì „íŒŒ**ì…ë‹ˆë‹¤. ì´ ë‘ ë°©ì‹ì€ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì²˜ìŒ ì „íŒŒí•˜ëŠ” ì£¼ì²´ê°€ ë‹¤ë¥´ë‹¤ëŠ” ì ì—ì„œ êµ¬ë¶„ë˜ì§€ë§Œ, í•œ ë²ˆ ì·¨ì†Œê°€ ì‹œì‘ë˜ë©´ í•´ë‹¹ ì‘ì—… íŠ¸ë¦¬ì˜ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì—ê²Œ ì¼ê´„ì ìœ¼ë¡œ ì·¨ì†Œ ì‹ í˜¸ê°€ ì „íŒŒë˜ë©°, ìƒìœ„ ì‘ì—…ì€ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì´ ì¢…ë£Œëœ í›„ì—ì•¼ í•¨ê»˜ ì¢…ë£Œëœë‹¤ëŠ” ì ì€ ë™ì¼í•©ë‹ˆë‹¤.


#### ì•”ì‹œì  ì·¨ì†Œ ì „íŒŒ

**ì•”ì‹œì  ì·¨ì†Œ ì „íŒŒ** ëŠ” í•˜ìœ„ ì‘ì—… ì¤‘ í•˜ë‚˜ê°€ ìƒìœ„ ì‘ì—…ì— ì˜ˆì™¸ì— ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ” ê²½ìš°ì— ë°œìƒí•©ë‹ˆë‹¤. í•˜ìœ„ ì‘ì—…ì´ ì˜ˆì™¸ë¥¼ ë˜ì§€ë©´, ì´ ì˜ˆì™¸ë¥¼ ë°›ì€ ìƒìœ„ ì‘ì—…ì€ ë‚˜ë¨¸ì§€ ì‹¤í–‰ ì¤‘ì¸ í•˜ìœ„ ì‘ì—…ë“¤ì—ê²Œ ì·¨ì†Œë¥¼ ì „íŒŒí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€, ìƒìœ„ ì‘ì—…ì´ í•˜ìœ„ ì‘ì—…ì˜ ì˜ˆì™¸ë¥¼ ì‹¤ì œë¡œ ë°›ì•„ì•¼ë§Œ ë‚˜ë¨¸ì§€ í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œê°€ ì „íŒŒëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¦‰, ì˜ˆì™¸ê°€ ìƒìœ„ ì‘ì—…ì—ì„œ ë¬´ì‹œë˜ê±°ë‚˜, í•˜ìœ„ ì‘ì—…ì—ì„œ ì²˜ë¦¬í•œë‹¤ë©´, ë‹¤ë¥¸ ì‘ì—…ì€ ê³„ì† ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ“¦ downloadImagesParallel()  â† 2ï¸âƒ£ í•˜ìœ„ ì‘ì—…ì´ ë˜ì§„ ì˜ˆì™¸ ë°›ìŒ <br>
>  â”œâ”€â”€ ğŸ§µ downloadImage(from: url)  <br>
>  â”œâ”€â”€ ğŸ§µ downloadImage(from: url)  â† 1ï¸âƒ£ ì˜ˆì™¸ ë°œìƒ ë° ìƒìœ„ ì‘ì—…ìœ¼ë¡œ throw <br>
>  â””â”€â”€ ğŸ§µ downloadImage(from: url)  â† 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ <br>

ì•„ë˜ ì˜ˆì œëŠ” `TaskGroup`ìœ¼ë¡œ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë³‘ë ¬ë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ì‘ì—… ì¤‘, ì¼ë¶€ í•˜ìœ„ ì‘ì—…ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë‚˜ë¨¸ì§€ ì‘ì—…ì— ì•”ì‹œì ìœ¼ë¡œ ì·¨ì†Œê°€ ì „íŒŒë˜ëŠ” êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```swift
let url = "https://picsum.photos/200/300"

func downloadImage(from url: String) async throws -> UIImage {
    do {
        try Task.checkCancellation()  // ğŸ‘ˆ ë„¤íŠ¸ì›Œí¬ ì „ì— ì·¨ì†Œ ìƒíƒœ í™•ì¸
        let url = URL(string: url)!
        let (data, _) = try await URLSession.shared.data(from: url)
        guard let image = UIImage(data: data) else {
            throw URLError(.cannotDecodeContentData)
        }
        return image
    } catch {
        print("ğŸŸ¡ ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")
        throw error
    }
}

func faileDownloadImage() async throws -> UIImage {
    try await Task.sleep(for: .seconds(1))
    throw CancellationError()
}

func downloadImages() async throws -> [UIImage] {
    try await withThrowingTaskGroup(of: UIImage.self) { group in
        group.addTask { 
            try await downloadImage(from: url)
        }
        group.addTask { 
            try await faileDownloadImage() // 2ï¸âƒ£ ì˜ˆì™¸ ë°œìƒ ë° ìƒìœ„ ì‘ì—…ìœ¼ë¡œ throw
        }
        group.addTask { // 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
            try await downloadImage(from: url)
        }
        
        var images: [UIImage] = []
        for try await image in group { // 1ï¸âƒ£ í•˜ìœ„ ì‘ì—…ì´ ë˜ì§„ ì˜ˆì™¸ ë°›ìŒ
            images.append(image)
        }
        return images
    }
}
Task { try? await downloadImages() }
```

> ğŸ’¡ Note: URLSessionì˜ `data(from:)` ë©”ì„œë“œëŠ” ì‘ì—… ì‹¤í–‰ ì¤‘ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ìˆ˜ì‹ í•˜ë©´ `URLError.cancelled` ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ë©°, í•´ë‹¹ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.



#### ëª…ì‹œì  ì·¨ì†Œ ì „íŒŒ

**ëª…ì‹œì  ì·¨ì†Œ ì „íŒŒ**ëŠ” `Task`ì˜ `cancel()`ì„ í˜¸ì¶œí•˜ê±°ë‚˜, `TaskGroup`ì˜ `cancelAll()`ì„ í†µí•´ í•˜ìœ„ ì‘ì—…ìœ¼ë¡œ **ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒ**í•¨ìœ¼ë¡œì¨ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

> ğŸ”¨ Task  â† 1ï¸âƒ£ `cancel()` í˜¸ì¶œ ë° ì‘ì—… ì·¨ì†Œ ì „íŒŒ <br>
>  &nbsp; â¹ &nbsp; ğŸ“¦ downloadImagesParallel()  â† 2ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ì „íŒŒ ìˆ˜ì‹  ë° í•˜ìœ„ ì‘ì—…ì— ë‹¤ì‹œ ì „íŒŒ  <br>
> &nbsp; â¹  &nbsp; â”œâ”€â”€ ğŸ§µ async let image1 = downloadImage(from: url)  â† 3ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ë° ì˜ˆì™¸ throw  <br>
> &nbsp; â¹ &nbsp; â”œâ”€â”€ ğŸ§µ async let image2 = downloadImage(from: url)  â† 3ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ë° ì˜ˆì™¸ throw  <br>
> &nbsp; â¹ &nbsp; â””â”€â”€ ğŸ§µ async let image3 = downloadImage(from: url)  â† 3ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ë° ì˜ˆì™¸ throw  <br>
> &nbsp;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì´ êµ¬ì¡°ëŠ” ìƒìœ„ `Task`ê°€ ëª…ì‹œì ìœ¼ë¡œ `cancel()`ì„ í˜¸ì¶œí•˜ë©´, í•˜ìœ„ ì‘ì—…ë“¤ì—ê²Œ ì·¨ì†Œ ì‹ í˜¸ê°€ ì „íŒŒë˜ê³ , ì´ë“¤ì´ **ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•˜ê±°ë‚˜ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰**í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

ì•„ë˜ ì˜ˆì œëŠ” `async-let`ìœ¼ë¡œ ë³‘ë ¬ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œë¥¼ ìˆ˜í–‰í•˜ë‹¤, 1ì´ˆ í›„ `Task.cancel()`ì„ í†µí•´ **í•˜ìœ„ ì‘ì—… ì „ì²´ì— ì·¨ì†Œê°€ ì „íŒŒ**ë˜ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

```swift
func downloadImages() async throws -> [UIImage] {  // 2ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ì „íŒŒ ìˆ˜ì‹  ë° í•˜ìœ„ ì‘ì—…ì— ë‹¤ì‹œ ì „íŒŒ
    async let image1: UIImage = downloadImage(from: url) 
    async let image2: UIImage = downloadImage(from: url)
    async let image3: UIImage = downloadImage(from: url)
    
    return try await [image1, image2, image3] // 3ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ë° ì˜ˆì™¸ throw
}

Task {
    let task = Task {
        do {
            _ = try await downloadImages()
        } catch {
            print("ğŸŸ¡ Task: ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")
        }
    }

    try await Task.sleep(for: .seconds(1))
    task.cancel() // 1ï¸âƒ£ `cancel()` í˜¸ì¶œ ë° ì‘ì—… ì·¨ì†Œ ì „íŒŒ
}
```

`Task` ë¿ë§Œ ì•„ë‹ˆë¼ `TaskGroup`ë„ `cancelAll()`ì„ í˜¸ì¶œí•˜ì—¬ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ **í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œë¥¼ ì „íŒŒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì˜ˆì œëŠ” `TaskGroup`ì„ ì‚¬ìš©í•´ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë³‘ë ¬ë¡œ ë‹¤ìš´ë¡œë“œí•˜ë‹¤ê°€, ì•½ 10ì¥ì˜ ì´ë¯¸ì§€ê°€ ìˆ˜ì‹ ë˜ë©´ `cancelAll()`ì„ í˜¸ì¶œí•˜ì—¬ ë‚¨ì€ ì‘ì—…ì„ ì·¨ì†Œí•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ì´í›„, ê·¸ ì‹œì ê¹Œì§€ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œëœ ì´ë¯¸ì§€ë“¤ë§Œ ë°˜í™˜í•©ë‹ˆë‹¤.

```swift
func downloadImages() async throws -> [UIImage] {
    try await withThrowingTaskGroup(of: UIImage.self) { group in // // 2ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ì „íŒŒ ìˆ˜ì‹  ë° í•˜ìœ„ ì‘ì—…ì— ë‹¤ì‹œ ì „íŒŒ
        for _ in 0..<1_000 {
            group.addTask { 
                try await downloadImage(from: url) // // 3ï¸âƒ£ ì‘ì—… ì·¨ì†Œ ë° ì˜ˆì™¸ throw
            }
        }
        
        var images: [UIImage] = []
        

        for try await image in group {
            if images.count == 10 {
                group.cancelAll()  // 1ï¸âƒ£ `cancelAll()` í˜¸ì¶œ ë° ì‘ì—… ì·¨ì†Œ ì „íŒŒ
            }
            
            images.append(image)
        }
        return images
    }
}
Task { try? await downloadImages() }
```

<br>

### êµ¬ì¡°í™”ë˜ì§€ ì•Šì€ ë™ì‹œì„±(Unstructured Concurrency)

êµ¬ì¡°í™”ë˜ì§€ ì•Šì€ ë™ì‹œì„±ì€ êµ¬ì¡°í™”ëœ ë™ì‹œì„±ê³¼ ë‹¬ë¦¬, ì‘ì—…ì˜ ì·¨ì†Œ ì‹ í˜¸ê°€ ë°”ê¹¥ ì‘ì—…ì—ì„œ ì•ˆìª½ ì‘ì—…ìœ¼ë¡œ ìë™ìœ¼ë¡œ ì „íŒŒë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŸ° êµ¬ì¡°ì—ì„œëŠ” ê° `Task`ì— ëŒ€í•´ ìˆ˜ë™ìœ¼ë¡œ ì·¨ì†Œ ì „íŒŒë¥¼ í•˜ê³ , í•„ìš”í•œ ì²˜ë¦¬ë¥¼ í•´ì•¼ í•©ë‹ˆë‹¤.

ì•„ë˜ ì˜ˆì œëŠ” `task1` ë‚´ë¶€ì— `task2`ë¥¼ ìƒì„±í•˜ê³ , `task1.cancel()` í˜¸ì¶œ ì´í›„ì—ë„ `task2`ëŠ” ê·¸ëŒ€ë¡œ ì‹¤í–‰ë˜ì–´ ì™„ë£Œë˜ëŠ” êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```swift
let task1 = Task {
    sleep(1)
    
    if Task.isCancelled {
        print("ğŸŸ¡ Task1: ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")
    }
    
    let task2 = Task {
        if Task.isCancelled {
            print("ğŸŸ¡ Task2: ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            return
        }
        
        print("â¡ï¸ Task2 ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
    }
}
task1.cancel()

Print "ğŸŸ¡ Task1: ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."
Print "â¡ï¸ Task2 ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
```



