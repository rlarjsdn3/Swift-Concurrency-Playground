import UIKit

//: ---
//: # Sendable
//: ## ì„œë¡œ ë‹¤ë¥¸ ë¹„ë™ê¸° ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì•ˆì „í•˜ê²Œ ê³µìœ ë  ìˆ˜ ìˆëŠ” íƒ€ì…
//: ---

//: ### ddd
//:
//* Swift Concurrencyê°€ í•´ê²°í•˜ê³ ì í•˜ëŠ” ëª©í‘œ ì„¤ëª… - ì»´íŒŒì¼ëŸ¬ê°€ ë°ì´í„° ê²½í•©ì´ ë°œìƒí–ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œë ¤ì£¼ì§€ ì•Šì„ ë¿ë”ëŸ¬, ë””ë²„ê·¸ê°€ í•˜ê¸°ê°€ ë§¤ìš° ì–´ë µë‹¤. ì»´íŒŒì¼ ê³¼ì •ì—ì„œ ìŠ¤ë ˆë“œì— ì•ˆì „í•˜ì§€ ì•Šì€ - ë°ì´í„° ê²½í•©ì„ ìœ ë°œí•  ê°€ëŠ¥ì„±ì´ ë†’ì€ - ì½”ë“œë¥¼ ì»´íŒŒì¼ëŸ¬ê°€ ê²€ì‚¬í•´ ë³´ë‹¤ ì•ˆì „í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²Œ ëª©í‘œì„
//
//* ì–´ë–»ê²Œ ë°ì´í„° ê²½í•©ì„ ë§‰ì„ ìˆ˜ ìˆì„ê¹Œ? ë°ì´í„° ê²½í•©ì€ ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ê³µìœ ëœ ê°€ë³€ ìƒíƒœì— ë™ì‹œì— ì ‘ê·¼í•˜ê³ , ì ì–´ë„ í•˜ë‚˜ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì“°ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ë°œìƒí•¨.
//
//* ì¦‰, í´ë˜ìŠ¤ì™€ ê°™ì€ ì°¸ì¡° íƒ€ì…ì´ ì½”ë“œì˜ ì—¬ëŸ¬ ë¶€ë¶„ì—ì„œ ë™ì‹œì— ì ‘ê·¼í•´ì„œ ìˆ˜ì •í•˜ë ¤ê³  í•  ë•Œ ë°ì´í„° ê²½í•©ì´ ë°œìƒí•  ìˆ˜ ìˆìŒ. ì´ë¥¼ ë°©ì§€í•˜ë ¤ë©´ êµ¬ì¡°ì²´ë‚˜ ì—´ê±°í˜•ê³¼ ê°™ì€ ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ ë°ì´í„° ê²½í•©ì˜ ê°€ëŠ¥ì„±ì´ ì¤„ì–´ë“¬
//
//* ì˜ˆë¥¼ ë“¤ì–´, _array1_ì„ _array2_ì— í• ë‹¹í•œ í›„, ê° ë°°ì—´ì— ì„œë¡œ ë‹¤ë¥¸ ê°’ì„ ë™ì‹œì— ì¶”ê°€í•˜ë”ë¼ë„, ê° ë°°ì—´ì„ ì„œë¡œ ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ
//
//```swift
//var array1 = [1, 2]
//var array2 = array1
//
//array1.append(3)
//array2.append(4)
//
//print(array1) // [1, 2, 3]
//print(array2) // [1, 2, 4]
//```
//
//* ì¦‰, ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ ì„œë¡œ ë‹¤ë¥¸ ì½”ë“œ ë¶€ë¶„ì—ì„œ ì„œë¡œ ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ ë°ì´í„° ê²½í•©ì´ ì¼ì–´ë‚  ìˆ˜ ì—†ìŒ. (ê³¼ê±°ë¶€í„° ì• í”Œì€ ê°€ëŠ¥í•˜ë©´ êµ¬ì¡°ì²´ íƒ€ì…ì„ ì‚¬ìš©í•˜ë¼ê³  ê¶Œì¥í•´ì™”ìŒ. [ì—¬ê¸°]()ì°¸ì¡°)
//
//* In Swift, value types provide a lot of thread safety out of the box. When you pass a value type from one place to the next, a copy is created which means that each place that holds a copy of your value type can freely mutate its copy without affecting other parts of the code.
//
//
//* ì´ëŸ° ì•„ì´ë””ì–´ì—ì„œ ì¶œë°œí•´ ë“±ì¥í•œ í”„ë¡œí† ì½œì´ ë°”ë¡œ Sendableì„. SwiftëŠ” Sendableì´ë¼ëŠ” ìƒˆë¡œìš´ ë§ˆì»¤ í”„ë¡œí† ì½œì„ ë„ì…í•˜ê³ , ì´ë¥¼ í†µí•´ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì ì¬ì ìœ¼ë¡œ ìŠ¤ë ˆë“œì— ì•ˆì „í•˜ì§€ ì•Šì€ ì½”ë“œë¥¼ ë§‰ì„ ìˆ˜ ìˆìŒ
//
//## Sendable
//
//* Sendable í”„ë¡œí† ì½œì€ ì„œë¡œ ë‹¤ë¥¸ ë™ì‹œì„± ì»¨í…ìŠ¤íŠ¸(concurrent context) ê°„ ê°’ì„ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” íƒ€ì…ì„. Sendableì€ ì•„ë¬´ëŸ° ìš”êµ¬ì‚¬í•­ì´ ì—†ìŒ
//
//* Sendableì€ ì•¡í„°, êµ¬ì¡°ì²´, í´ë˜ìŠ¤ ë“± ì—¬ëŸ¬ íƒ€ì…ì—ì„œ ì¤€ìˆ˜í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ê° íƒ€ì…ë§ˆë‹¤ Sendable ìš”êµ¬ì‚¬í•­ì´ ì¡°ê¸ˆì”© ë‹¤ë¦„.
//
//### ì•¡í„°
//
//* ì•¡í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Sendableì„ ì¤€ìˆ˜í•¨.
//
//* ë‹¤ë§Œ, ì•¡í„°ê°€ ë‹¤ë¥¸ í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ëŠ” ê²½ìš°, í•´ë‹¹ í”„ë¡œí† ì½œì´ Sendableì„ ì¤€ìˆ˜í•´ì•¼ í•¨.
//
//```swift
//protocol ImageDownloader: Sendable { ... }
//
//actor DefaultImageDownloader: ImageDownloader { ... }
//```
//
//### êµ¬ì¡°ì²´
//
//* In Swift, value types provide a lot of thread safety out of the box. When you pass a value type from one place to the next, a copy is created which means that each place that holds a copy of your value type can freely mutate its copy without affecting other parts of the code.
//
//* Because of this behavior, value types like structs and enums are Sendable by default as long as all of their members are also Sendable.
//
//```swift
//struct Dog {
//    var name = "Whitey"
//    var age = 1
//}
//```
//
//* ìœ„ êµ¬ì¡°ì²´ëŠ” Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•¨. Swift ì»´íŒŒì¼ëŸ¬ëŠ” êµ¬ì¡°ì²´ ë‚´ë¶€ì˜ ëª¨ë“  í”„ë¡œí¼í‹°ê°€ Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ëŠ” íƒ€ì…ì´ë¼ë©´ ìë™ìœ¼ë¡œ êµ¬ì¡°ì²´ì— Sendable í”„ë¡œí† ì½œ ì¤€ìˆ˜ì„±ì„ ì¶”ê°€í•¨
//
//```swift
//class Font { ... }
//
//struct Text {
//    var title: String
//    var font: Font = .headline
//}
//```
//
//* ë°˜ë©´, ìœ„ êµ¬ì¡°ì²´ëŠ” Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ì§€ ëª»í•¨. ì™œëƒí•˜ë©´ _font_ í”„ë¡œí¼í‹°ì˜ íƒ€ì…ì´ Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì„.
//
//
//### í´ë˜ìŠ¤
//
//* í´ë˜ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•  ìˆ˜ ì—†ì§€ë§Œ, ê·¹íˆ ì œí•œì ì¸ ìƒí™©ì—ì„œëŠ” ì¤€ìˆ˜ì„±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŒ. ê·¸ë¦¬ê³  êµ¬ì¡°ì²´ì™€ ë‹¬ë¦¬, ì¡°ê±´ì„ ë§Œì¡±í•œë‹¤ í•˜ë”ë¼ë„ ìë™ìœ¼ë¡œ Sendable ì¤€ìˆ˜ì„±ì„ ì¶”ê°€í•˜ì§€ ì•ŠìŒ. ì§ì ‘ í•´ë‹¹ í´ë˜ìŠ¤ê°€ Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•œë‹¤ê³  ì‘ì„±í•´ì•¼ í•¨
//
//```swift
//class ImageDownloader: Sendable {
//}
//```
//
//* í´ë˜ìŠ¤ê°€ final í´ë˜ìŠ¤ì´ê³ , ë‚´ë¶€ í”„ë¡œí¼í‹°ê°€ ëª¨ë‘ ë¶ˆë³€(immuatable)ì´ë©´ Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•  ìˆ˜ ìˆìŒ
//
//* í´ë˜ìŠ¤ì— ìƒì†ì„ í—ˆìš©í•˜ê²Œ ë˜ë©´, í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ê¸°ëŠ¥ì„ ì¬ì •ì˜í•˜ê±°ë‚˜ ì¶”ê°€í•˜ëŠ” ê³¼ì •ì—ì„œ Sendable ì¤€ìˆ˜ë¥¼ ìœ„í•œ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ëª»í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í—ˆìš©í•˜ì§€ ì•ŠìŒ
//
//* ì•„ìš¸ëŸ¬, êµ¬ì¡°ì²´ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë‚´ë¶€ í”„ë¡œí¼í‹°ê°€ ëª¨ë‘ Sendalbe í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•œë‹¤ë©´ í´ë˜ìŠ¤ë„ Sendableì´ ë  ìˆ˜ ìˆìŒ
//
//#### @unchecked Sendable
//
//* @unchecked Sendableì€ í•´ë‹¹ í´ë˜ìŠ¤ê°€ Sendableí•˜ë‹¤ëŠ” ê±¸ ê°œë°œìê°€ ë³´ì¥í•˜ë©°, ì»´íŒŒì¼ëŸ¬ê°€ ê²€ì‚¬í•˜ì§€ ë§ë¼ëŠ” ì˜ë¯¸ì„.
//
//* ì¼ë°˜ì ìœ¼ë¡œ í´ë˜ìŠ¤ì— ë½, ì§ë ¬ ë””ìŠ¤íŒ¨ì¹˜ íë‚˜ ë””ìŠ¤íŒ¨ì¹˜ ì„¸ë§ˆí¬ì–´ ë“± ë™ê¸°í™” ë§¤ì»¤ë‹ˆì¦˜ì„ ìì²´ì ìœ¼ë¡œ ì œê³µí•˜ê³  ìˆìœ¼ë©°, ë°ì´í„° ê²½í•©ì´ ë°œìƒí•˜ì§€ ì•Šì„ê±°ë¼ í™•ì‹ í•  ìˆ˜ ìˆì„ ë•Œë§Œ í•´ë‹¹ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì•¼ í•¨.
//
//* ê·¸ë¦¬ê³  ëª¨ë“ˆ(íƒ€ê²Ÿ) ë‚´ ëª¨ë“  ì½”ë“œë¥¼ ì¼ê´„ì ìœ¼ë¡œ Swift Concurrencyì— ë§ê²Œ ë³€í™˜í•˜ëŠ” ê±´ ë¶ˆê°€ëŠ¥í•¨. ì ì§„ì ìœ¼ë¡œ Swift concurrencyë¥¼ ë„ì…í•˜ê³ ì í•˜ëŠ” ëª©ì ìœ¼ë¡œë„ í•´ë‹¹ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
//
//```swift
//final class ImageDownloader: @unchecked Sendable {
//
//}
//```
//
//
//## @Sendable
//
//* í´ë¡œì €ëŠ” ì„œë¡œ ë‹¤ë¥¸ ë™ì‹œì„± ê²½ê³„ë¥¼ ë„˜ë‚˜ë“¤ì–´ ì‹¤í–‰ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, - (ë‚´ìš© ë³´ì¶©) - ì˜ëª»ëœ í´ë¡œì €ì˜ ì‚¬ìš©ì€ ë°ì´í„° ê²½í•©ìœ¼ë¡œ ì‰½ê²Œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŒ.
//-> ë™ì‹œì„± ê²½ê³„ë¥¼ ë„˜ë‚˜ë“ ë‹¤ -> ì´ ë§ ë³´ì¶©
//
//* ë”°ë¼ì„œ í•¨ìˆ˜ë„ Sendableí•˜ê²Œ ë§Œë“¤ì–´ì•¼ í•¨. í•¨ìˆ˜(í´ë¡œì €)ë„ Sendableì´ ë  ìˆ˜ ìˆìŒ. ë‹¤ë§Œ, í•¨ìˆ˜ëŠ” í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— @escapingì²˜ëŸ¼ ì†ì„± í˜•íƒœë¡œ í•´ë‹¹ ê¸°ëŠ¥ì„ ì œê³µí•¨.
//
//```swift
//
//```
//
//* í´ë¡œì € ì„ ì–¸ ì‹œ, ë§¤ê°œë³€ìˆ˜ ì•ì— @Sendable í‚¤ì›Œë“œë¥¼ ë¶™ì´ë©´ í•´ë‹¹ í´ë¡œì €ëŠ” Sendableí•˜ê²Œ ë¨. í´ë¡œì €ê°€ Sendableí•˜ë‹¤ëŠ” ì˜ë¯¸ëŠ” í•´ë‹¹ í´ë¡œì €ê°€ ìº¡ì²˜í•˜ëŠ” ëª¨ë“  ê°’ë“¤ì€ Sendable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì„.
//
//```swift
//
//```
//
//* ì‹¤ì œë¡œ Taskì˜ operation í´ë¡œì €ë¥¼ ì‚´í´ë³´ë©´ @Sendable ì†ì„±ì„ ê°€ì§„ë‹¤ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŒ. ì¦‰, operation í´ë¡œì €ì—ì„œ ìº¡ì²˜í•˜ëŠ” ëª¨ë“  ê°’ì€ Sendableì´ì–´ì•¼ í•œë‹¤ëŠ” ëœ»ì„.
//
//
//### Sending
//
//* Swift 6.0ë¶€í„° sending í‚¤ì›Œë“œê°€ ìƒˆë¡­ê²Œ ë„ì…ë¨. sending í‚¤ì›Œë“œëŠ” @Sendable í‚¤ì›Œë“œì™€ ê¸°ëŠ¥ì´ ë¹„ìŠ·í•˜ì§€ë§Œ, ìº¡ì²˜ê°€ ì¼ì–´ë‚œ í›„ì—ë„ ê°’ì´ ë°”ë€” ê°€ëŠ¥ì„±ì´ ì—†ë‹¤ë©´, Sendableí•˜ì§€ ì•Šë”ë¼ë„ í•´ë‹¹ í´ë¡œì € ë‚´ì—ì„œ ê°’ì„ ì¡°ì •í•  ìˆ˜ ìˆë‹¤ëŠ” íŠ¿ì§•ì´ ìˆìŒ
//
//```swift
//func doTask(closure: @Sendable () async -> Void) {
//    closure()
//}
//
//Task {
//    await doTask {
//        counter.value += 1 // ğŸ”´
//    }
//}
//```
//
//* ìœ„ doTask ë©”ì„œë“œëŠ” @Sendable ì†ì„±ì˜ í´ë¡œì €ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŒ. ê·¸ë¦¬ê³  í•´ë‹¹ í´ë¡œì € ë‚´ë¶€ì—ì„œ counter ê°’ì„ 1 ì¦ê°€ì‹œí‚¤ê³  ìˆìŒ. í•˜ì§€ë§Œ counterëŠ” Sendableí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¹ì—° ì˜¤ë¥˜ê°€ ë°œìƒí•¨.
//
//```swift
//func doTask(closure: sending () async -> Void) {
//    closure()
//}
//
//Task {
//    await doTask {
//        counter.value += 1 // ğŸ”µ
//    }
//    // counter.value += 1 // ğŸŸ¡ doTask ì´í›„ì— ê°’ì´ ë°”ë€ë‹¤ë©´ ì—ëŸ¬ê°€ ë°œìƒ
//}
//```
//
//* í•˜ì§€ë§Œ, sending í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ í´ë¡œì €ë¥¼ ë°›ëŠ”ë‹¤ë©´, ìœ„ ì½”ë“œëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ. ë‹¤ë§Œ, sending í´ë¡œì € ì´í›„ì— ê°’ì„ ë³€ê²½í•˜ë ¤ê³  ì‹œë„í•˜ë©´(ì£¼ì„ì„ í•´ì œí•˜ë©´) ì˜¤ë¥˜ê°€ ë°œìƒí•¨. ì´ë ‡ë“¯ sending í‚¤ì›Œë“œëŠ” ë°ì´í„° ê²½í•©ì´ ë°œìƒí•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì½”ë“œì— í•œí•´ì„œ Sendableí•˜ì§€ ì•Šì€ ê°’ì´ë¼ë„ í•´ë‹¹ í´ë¡œì € ë‚´ë¶€ì—ì„œ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•¨.
//
//* ì™œ ì´ í‚¤ì›Œë“œê°€ ìƒê²¨ë‚˜ê²Œ ë˜ì—ˆëŠ”ê°€? -> ë‚´ìš© ë³´ì¶©
//
//```swift
//Task.init()
//```
//
//* Swift 6ë¡œ ë„˜ì–´ì˜¤ë©´ì„œ Task, Continuation ë“± ë§ì€ ê°ì²´ê°€ @Sendableì—ì„œ sendingìœ¼ë¡œ í‚¤ì›Œë“œê°€ ë°”ë€œ
//
//
//
//## ì •ë¦¬
//
//* Sendable ì •ì˜
//
//* ì•¡í„° /êµ¬ì¡°ì²´ / í´ë˜ìŠ¤ì—ì„œ Sendable
//
//* @Sendable í´ë¡œì €
//
//* Sendableì´ ì¤€ìˆ˜ë  ìˆ˜ ìˆëŠ” ì˜ˆ í‘œë¡œ ì •ë¦¬
